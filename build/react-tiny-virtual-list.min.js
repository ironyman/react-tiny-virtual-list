!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["exports","react","prop-types"],e):e(t.VirtualList={},t.React,t.PropTypes)}(this,function(p,m,t){var i=function(t,e){return(i=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}))(t,e)};var a,f,S=function(){return(S=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};(z=a=a||{}).AUTO="auto",z.START="start",z.CENTER="center",z.END="end",(z=p.ScrollDirection||(p.ScrollDirection={})).HORIZONTAL="horizontal",z.VERTICAL="vertical",(z=f=f||{}).OBSERVED="observed",z.REQUESTED="requested";(z={})[p.ScrollDirection.VERTICAL]="scrollTop",z[p.ScrollDirection.HORIZONTAL]="scrollLeft";var o=z,I=((z={})[p.ScrollDirection.VERTICAL]="height",z[p.ScrollDirection.HORIZONTAL]="width",z),r=((z={})[p.ScrollDirection.VERTICAL]="top",z[p.ScrollDirection.HORIZONTAL]="left",z),s=((z={})[p.ScrollDirection.VERTICAL]="marginTop",z[p.ScrollDirection.HORIZONTAL]="marginLeft",z),l=((z={})[p.ScrollDirection.VERTICAL]="marginBottom",z[p.ScrollDirection.HORIZONTAL]="marginRight",z),e=(n.prototype.updateConfig=function(t){var e=t.itemCount,i=t.itemSizeGetter,t=t.estimatedItemSize;null!=e&&(this.itemCount=e),null!=t&&(this.estimatedItemSize=t),null!=i&&(this.itemSizeGetter=i)},n.prototype.getLastMeasuredIndex=function(){return this.lastMeasuredIndex},n.prototype.getSizeAndPositionForIndex=function(t){if(t<0||t>=this.itemCount)throw Error("Requested index ".concat(t," is outside of range 0..").concat(this.itemCount));if(t>this.lastMeasuredIndex){for(var e=this.getSizeAndPositionOfLastMeasuredItem(),i=e.offset+e.size,o=this.lastMeasuredIndex+1;o<=t;o++){var n=this.itemSizeGetter(o);if(null==n||isNaN(n))throw Error("Invalid size returned for index ".concat(o," of value ").concat(n));this.itemSizeAndPositionData[o]={offset:i,size:n},i+=n}this.lastMeasuredIndex=t}return this.itemSizeAndPositionData[t]},n.prototype.getSizeAndPositionOfLastMeasuredItem=function(){return 0<=this.lastMeasuredIndex?this.itemSizeAndPositionData[this.lastMeasuredIndex]:{offset:0,size:0}},n.prototype.getTotalSize=function(){var t=this.getSizeAndPositionOfLastMeasuredItem();return t.offset+t.size+(this.itemCount-this.lastMeasuredIndex-1)*this.estimatedItemSize},n.prototype.getUpdatedOffsetForIndex=function(t){var e=t.align,e=void 0===e?a.START:e,i=t.containerSize,o=t.currentOffset;if(i<=0)return 0;var n,r=this.getSizeAndPositionForIndex(t.targetIndex),s=r.offset,l=s-i+r.size;switch(e){case a.END:n=l;break;case a.CENTER:n=s-(i-r.size)/2;break;case a.START:n=s;break;default:n=Math.max(l,Math.min(s,o))}t=this.getTotalSize();return Math.max(0,Math.min(t-i,n))},n.prototype.getVisibleRange=function(t){var e=t.containerSize,i=t.offset,t=t.overscanCount;if(0===this.getTotalSize())return{};var o=i+e,e=this.findNearestItem(i);if(void 0===e)throw Error("Invalid offset ".concat(i," specified"));for(var n=this.getSizeAndPositionForIndex(e),i=n.offset+n.size,r=e;i<o&&r<this.itemCount-1;)i+=this.getSizeAndPositionForIndex(++r).size;return t&&(e=Math.max(0,e-t),r=Math.min(r+t,this.itemCount-1)),{start:e,stop:r}},n.prototype.resetItem=function(t){this.lastMeasuredIndex=Math.min(this.lastMeasuredIndex,t-1)},n.prototype.findNearestItem=function(t){if(isNaN(t))throw Error("Invalid offset ".concat(t," specified"));t=Math.max(0,t);var e=this.getSizeAndPositionOfLastMeasuredItem(),i=Math.max(0,this.lastMeasuredIndex);return e.offset>=t?this.binarySearch({high:i,low:0,offset:t}):this.exponentialSearch({index:i,offset:t})},n.prototype.binarySearch=function(t){for(var e,i,o=t.low,n=t.high,r=t.offset;o<=n;){if(e=o+Math.floor((n-o)/2),(i=this.getSizeAndPositionForIndex(e).offset)===r)return e;i<r?o=e+1:r<i&&(n=e-1)}return 0<o?o-1:0},n.prototype.exponentialSearch=function(t){for(var e=t.index,i=t.offset,o=1;e<this.itemCount&&this.getSizeAndPositionForIndex(e).offset<i;)e+=o,o*=2;return this.binarySearch({high:Math.min(e,this.itemCount-1),low:Math.floor(e/2),offset:i})},n);function n(t){var e=t.itemCount,i=t.estimatedItemSize;this.itemSizeGetter=t.itemSizeGetter,this.itemCount=e,this.estimatedItemSize=i,this.itemSizeAndPositionData={},this.lastMeasuredIndex=-1}var c,d,g={overflow:"auto",willChange:"transform",WebkitOverflowScrolling:"touch"},y={position:"relative",width:"100%",minHeight:"100%"},u={position:"absolute",top:0,left:0,width:"100%"},h=S(S({},u),{position:"sticky"}),z=(c=m.PureComponent,i(d=v,z=c),d.prototype=null===z?Object.create(z):(T.prototype=z.prototype,new T),v.prototype.componentDidMount=function(){var t=this.props,e=t.scrollOffset,t=t.scrollToIndex;this.rootNode.addEventListener("scroll",this.handleScroll,{passive:!0}),null!=e?this.scrollTo(e):null!=t&&this.scrollTo(this.getOffsetForIndex(t))},v.prototype.componentDidUpdate=function(t,e){var i=this.state,o=i.offset,i=i.scrollChangeReason,n=this.props,r=n.estimatedItemSize,s=n.itemCount,l=n.itemSize,a=n.scrollOffset,n=t.scrollToIndex!==n.scrollToIndex||t.scrollToAlignment!==n.scrollToAlignment,c=t.itemCount!==s||t.itemSize!==l||t.estimatedItemSize!==r;t.itemSize!==l&&this.sizeAndPositionManager.updateConfig({itemSizeGetter:this.itemSizeGetter(t.itemSize)}),t.itemCount===s&&t.estimatedItemSize===r||this.sizeAndPositionManager.updateConfig({itemCount:t.itemCount,estimatedItemSize:this.getEstimatedItemSize(t)}),c&&this.recomputeSizes(),t.scrollOffset!==a?this.setState({offset:t.scrollOffset||0,scrollChangeReason:f.REQUESTED}):"number"==typeof t.scrollToIndex&&(n||c)&&this.setState({offset:this.getOffsetForIndex(t.scrollToIndex,t.scrollToAlignment,t.itemCount),scrollChangeReason:f.REQUESTED}),e.offset!==o&&i===f.REQUESTED&&this.scrollTo(o)},v.prototype.componentWillUnmount=function(){this.rootNode.removeEventListener("scroll",this.handleScroll)},v.prototype.scrollTo=function(t){var e=this.props.scrollDirection,e=void 0===e?p.ScrollDirection.VERTICAL:e;this.rootNode[o[e]]=t},v.prototype.getOffsetForIndex=function(t,e,i){void 0===e&&(e=this.props.scrollToAlignment),void 0===i&&(i=this.props.itemCount);var o=this.props.scrollDirection,o=void 0===o?p.ScrollDirection.VERTICAL:o;return this.sizeAndPositionManager.getUpdatedOffsetForIndex({align:e,containerSize:this.props[I[o]],currentOffset:this.state&&this.state.offset||0,targetIndex:t=t<0||i<=t?0:t})},v.prototype.recomputeSizes=function(t){void 0===t&&(t=0),this.styleCache={},this.sizeAndPositionManager.resetItem(t)},v.prototype.render=function(){var e=this,t=this.props,i=(t.estimatedItemSize,t.height),o=t.overscanCount,o=void 0===o?3:o,n=t.renderItem,r=t.onItemsRendered,s=t.scrollDirection,s=void 0===s?p.ScrollDirection.VERTICAL:s,l=t.stickyIndices,a=t.style,c=t.width,t=function(t,e){var i={};for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(i[n[o]]=t[n[o]]);return i}(t,["estimatedItemSize","height","overscanCount","renderItem","itemCount","itemSize","onItemsRendered","onScroll","scrollDirection","scrollOffset","scrollToIndex","scrollToAlignment","stickyIndices","style","width"]),f=this.state.offset,f=this.sizeAndPositionManager.getVisibleRange({containerSize:this.props[I[s]]||0,offset:f,overscanCount:o}),o=f.start,d=f.stop,u=[],f=S(S(S({},g),a),{height:i,width:c}),i=S(S({},y),((a={})[I[s]]=this.sizeAndPositionManager.getTotalSize(),a));if(null!=l&&0!==l.length&&(l.forEach(function(t){return u.push(n({index:t,style:e.getStyle(t,!0)}))}),s===p.ScrollDirection.HORIZONTAL)&&(i.display="flex"),void 0!==o&&void 0!==d){for(var h=o;h<=d;h++)null!=l&&l.includes(h)||u.push(n({index:h,style:this.getStyle(h,!1)}));"function"==typeof r&&r({startIndex:o,stopIndex:d})}return m.createElement("div",S({ref:this.getRef},t,{style:f}),m.createElement("div",{style:i},u))},v.prototype.getNodeOffset=function(){var t=this.props.scrollDirection,t=void 0===t?p.ScrollDirection.VERTICAL:t;return this.rootNode[o[t]]},v.prototype.getEstimatedItemSize=function(t){return(t=void 0===t?this.props:t).estimatedItemSize||"number"==typeof t.itemSize&&t.itemSize||50},v.prototype.getSize=function(t,e){return"function"==typeof e?e(t):Array.isArray(e)?e[t]:e},v.prototype.getStyle=function(t,e){var i,o,n=this.styleCache[t];return n||(n=void 0===(n=this.props.scrollDirection)?p.ScrollDirection.VERTICAL:n,i=(o=this.sizeAndPositionManager.getSizeAndPositionForIndex(t)).size,o=o.offset,this.styleCache[t]=e?S(S({},h),((t={})[I[n]]=i,t[s[n]]=o,t[l[n]]=-(o+i),t.zIndex=1,t)):S(S({},u),((e={})[I[n]]=i,e[r[n]]=o,e)))},v.defaultProps={overscanCount:3,scrollDirection:p.ScrollDirection.VERTICAL,width:"100%"},v.propTypes={estimatedItemSize:t.number,height:t.oneOfType([t.number,t.string]).isRequired,itemCount:t.number.isRequired,itemSize:t.oneOfType([t.number,t.array,t.func]).isRequired,onScroll:t.func,onItemsRendered:t.func,overscanCount:t.number,renderItem:t.func.isRequired,scrollOffset:t.number,scrollToIndex:t.number,scrollToAlignment:t.oneOf([a.AUTO,a.START,a.CENTER,a.END]),scrollDirection:t.oneOf([p.ScrollDirection.HORIZONTAL,p.ScrollDirection.VERTICAL]),stickyIndices:t.arrayOf(t.number),style:t.object,width:t.oneOfType([t.number,t.string])},v);function T(){this.constructor=d}function v(){var o=null!==c&&c.apply(this,arguments)||this;return o.itemSizeGetter=function(e){return function(t){return o.getSize(t,e)}},o.sizeAndPositionManager=new e({itemCount:o.props.itemCount,itemSizeGetter:o.itemSizeGetter(o.props.itemSize),estimatedItemSize:o.getEstimatedItemSize()}),o.state={offset:o.props.scrollOffset||null!=o.props.scrollToIndex&&o.getOffsetForIndex(o.props.scrollToIndex)||0,scrollChangeReason:f.REQUESTED},o.styleCache={},o.getRef=function(t){o.rootNode=t},o.handleScroll=function(t){var e=o.props.onScroll,i=o.getNodeOffset();i<0||o.state.offset===i||t.target!==o.rootNode||(o.setState({offset:i,scrollChangeReason:f.OBSERVED}),"function"==typeof e&&e(i,t))},o}p.default=z,Object.defineProperty(p,"__esModule",{value:!0})});
